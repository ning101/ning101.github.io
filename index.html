<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">






<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta name="description" content="16计师唐宁的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="唐宁的博客">
<meta property="og:url" content="http://ning101.cn/index.html">
<meta property="og:site_name" content="唐宁的博客">
<meta property="og:description" content="16计师唐宁的个人博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="唐宁的博客">
<meta name="twitter:description" content="16计师唐宁的个人博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://ning101.cn/">





  <title>唐宁的博客</title>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



	<div id="vk_api_transport"></div>
	<script type="text/javascript">
		window.vkAsyncInit = function() {
			VK.init({
				apiId: eE3BBACrhACtlGIwD80sAMtl-gzGzoHsz
			});

			

			
		};
		setTimeout(function() {
			var el = document.createElement("script");
			el.type = "text/javascript";
			el.src = "//vk.com/js/api/openapi.js";
			el.async = true;
			document.getElementById("vk_api_transport").appendChild(el);
		}, 0);
	</script>















  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">唐宁的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">记录学习的技能与遇到的问题</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            公益404
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2021/03/21/nginx配置/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/21/nginx配置/" itemprop="url">nginx配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-21T19:40:52+08:00">
                2021-03-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index">
                    <span itemprop="name">nginx</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2019/05/15/编码简介/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/15/编码简介/" itemprop="url">编码简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-15T00:00:00+08:00">
                2019-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编码/" itemprop="url" rel="index">
                    <span itemprop="name">编码</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="编码与字符集"><a href="#编码与字符集" class="headerlink" title="编码与字符集"></a>编码与字符集</h2><p>&emsp;&emsp;在计算机底层，字符是用一串二进制数字存储的，如“011001100110…”。人类只认识文字，可惜计算机只认 0 和 1，双方都不能妥协，那就必须要有一个从文字到 0、1 的映射了。从我们可以看到的字符到 0、1 的映射称为编码，反过来从 0、1 到文字叫解码。这个就是编码的含义。<br>&emsp;&emsp;<strong>1、什么是字符集：</strong><br>&emsp;&emsp;字符集只是一个规则集合的名字，字符集 = 字库表（character repertoire）、编码字符集（coded character set）、字符编码（character encoding form）。<br>&emsp;&emsp;<strong>2、字库表：</strong><br>&emsp;&emsp;字库表是一个相当于所有可读或者可显示字符的数据库，字库表决定了整个字符集能够展现表示的所有字符的范围。<br>&emsp;&emsp;<strong>3、编码字符集：</strong>（简称字符集，如Unicode、ASCII）<br>编码字符集，用一个编码值code point来表示一个字符（即该字符在子库表中的位置），这个值称为字符对应于编码字符集（如：Unicode、ASCII）的序号。<br>&emsp;&emsp;<strong>4、字符编码：</strong><br>&emsp;&emsp;字符编码，是编码字符集和实际存储数值之间的转换关系。字符，是根据字符编码方案转换为一个二进制数值存储在计算机中的。<br>所以，字符编码是定义在字符集上的映射规则。（字符——–&gt;计算机中的实际存储值）</p>
<h2 id="字符集简介"><a href="#字符集简介" class="headerlink" title="字符集简介"></a>字符集简介</h2><h3 id="ANSI、GB2312、GBK、GB18030和-UNICODE"><a href="#ANSI、GB2312、GBK、GB18030和-UNICODE" class="headerlink" title="ANSI、GB2312、GBK、GB18030和 UNICODE"></a>ANSI、GB2312、GBK、GB18030和 UNICODE</h3><p>&emsp;&emsp;很久很久以前，有一群人，他们决定用8个可以开合的晶体管来组合成不同的状态，以表示世界上的万物，他们把这称为”字节”。再后来，他们又做了一些可以处理这些字节的机器，机器开动了，可以用字节来组合出很多状态，状态开始变来变去，他们就把这机器称为”计算机”。</p>
<p>&emsp;&emsp;开始计算机只在美国用。八位的字节一共可以组合出256(2的8次方)种不同的状态。他们把其中的编号从0开始的32种状态分别规定了特殊的用途，一但终端、打印机遇上约定好的这些字节被传过来时，就要做一些约定的动作。遇上 00×10, 终端就换行，遇上0×07, 终端就向人们嘟嘟叫，例好遇上0x1b, 打印机就打印反白的字，或者终端就用彩色显示字母。他们看到这样很好，于是就把这些0×20以下的字节状态称为”控制码”。</p>
<p>&emsp;&emsp;他们又把所有的空格、标点符号、数字、大小写字母分别用连续的字节状态表示，一直编到了第127号，这样计算机就可以用不同字节来存储英语的文字 了。大家看到这样，都感觉很好，于是大家都把这个方案叫做 ANSI 的”Ascii”编码（American Standard Code for Information Interchange，美国信息互换标准代码）。当时世界上所有的计算机都用同样的ASCII方案来保存英文文字。</p>
<p>&emsp;&emsp;后来计算机发展越来越广泛，世界各国为了可以在计算机保存他们的文字，他们决定采用127号之后的空位来表示这些新的字母、符号，还加入了很多画表格时需要用下到的横线、竖线、交叉等形状，一直把序号编到了最后一个状态255。从128到255这一页的字符集被称”扩展字符集”。但是原有的编号方法，已经再也放不下更多的编码。</p>
<p>&emsp;&emsp;等中国人们得到计算机时，已经没有可以利用的字节状态来表示汉字，况且有6000多个常用汉字需要保存呢。于是国人就自主研发，把那些127号之后的奇异符号们直接取消掉。规定：一个小于127的字符的意义与原来相同，但两个大于127的字符连在一起时，就表示一个汉字，前面的一个字节（他称之为高字节）从0xA1用到 0xF7，后面一个字节（低字节）从0xA1到0xFE，这样我们就可以组合出大约7000多个简体汉字了。在这些编码里，我们还把数学符号、罗马希腊的字母、日文的假名们都编进去了，连在 ASCII 里本来就有的数字、标点、字母都统统重新编了两个字节长的编码，这就是常说的”全角”字符，而原来在127号以下的那些就叫”半角”字符了。</p>
<p>&emsp;&emsp;中国人民看到这样很不错，于是就把这种汉字方案叫做 “GB2312″。GB2312 是对 ASCII 的中文扩展。</p>
<p>&emsp;&emsp;但是中国的汉字太多了，后来还是不够用，于是干脆不再要求低字节一定是127号之后的内码，只要第一个字节是大于127就固定表示这是一个汉字的开始，不管后面跟的是不是 扩展字符集里的内容。结果扩展之后的编码方案被称为 GBK 标准，GBK 包括了 GB2312 的所有内容，同时又增加了近20000个新的汉字（包括繁体字）和符号。后来少数民族也要用电脑了，于是我们再扩展，又加了几千个新的少数民族的字，GBK 扩成了 GB18030。从此之后，中华民族的文化就可以在计算机时代中传承了。</p>
<p>&emsp;&emsp;因为当时各个国家都像中国这样搞出一套自己的编码标准，结果互相之间谁也不懂谁的编码，谁也不支持别人的编码。当时的中国人想让电脑显示汉字，就必须装上一个”汉字系统”，专门用来处理汉字的显示、输入的问题，装错了字符系统，显示就会乱了套。这怎么办？就在这时，一个叫ISO（国际标谁化组织）的国际组织决定着手解决这个问题。他们采用的方法很简单：废了所有的地区性编码方案，重新搞一个包括了地球上所有文化、所有字母和符号的编码！他们打算叫它”Universal Multiple-Octet Coded Character Set”，简称 UCS, 俗称 “UNICODE”。</p>
<p>&emsp;&emsp;现实生活中遇到的编码基本都是Unicode的，因为Unicode兼容了大多数老版本的编码规范，例如ASCII。Unicode编码定义了这个世界上几乎所有字符的数字表示。每个字符在Unicode中都有一个唯一的码点(Code Point)表示，而很多人说的Unicode其实是想表达<a href="即UTF,Unicode Transformation Formats">Unicode转换格式</a>，这就是UTF-8/UTF-16/UTF-32的前缀来源。</p>
<p>&emsp;&emsp;UTF的存在是为了解决码点在计算机中的二进制表现形式而设计的，因为存在计算机的存储位宽、兼容古老格式、码点值过大等问题。码点经过映射后得到二进制串的转换格式单位称为<a href="Code Unit">码元</a>。也就是说如果一个码点的UTF表示有n个字节，码元为8位，那就有n个码元。每种UTF的码元都不同，其宽度被作为区分写在了UTF的后缀–这就是UTF-8/UTF-16/UTF-32的由来。UTF8的码元是8位的，UTF16的码元是16位的。大部分的编程语言采用16位16位的码元作为机内表示。这就是我们在各种语言中获取字符串长度是会出现这么多混乱的原因。事实上获取的不是字符个数，而是码元个数。一旦我们的字符串中包含了位于基本平面之外的码点，就需要个多的码元来表示，获取的字符数就比实际要多。</p>
<p>&emsp;&emsp;不同的UTF映射的二进制串不同，但是它们背后的[码点]是一致的。由于平时人们误把[转换格式]也称为[编码]，所以很容易分不清Unicode和UTF的区别。Unicode发展到今天扩展到了21位(从U+0000到U+10FFFF)，<strong>所以Unicode不是16位的编码</strong>，它是21位的。这21位提供了1,114,112个码点，目前只有大概10%在使用，还有很大的扩充空间。</p>
<p>&emsp;&emsp;Unicode的字符不是一次性定义的，而是采用了分区定义，每个区可以存放 65536 个（2^16）字符，称为一个平面（plane）。目前，一共有17个（2^5）平面，也就是说，整个 Unicode 字符集的大小现在是2^21。最前面的65536个字符位，称为基本平面（简称 BMP ），它的码点范围是从0到2^16-1，写成16进制就是从U+0000到U+FFFF。所有最常见的字符都放在这个平面，除了emoji(1号平面)，这是Unicode最先定义和公布的一个平面。剩下的字符都放在辅助平面（简称SMP），码点范围从U+010000到U+10FFFF。</p>
<h2 id="简述一下各种UTF的特质："><a href="#简述一下各种UTF的特质：" class="headerlink" title="简述一下各种UTF的特质："></a>简述一下各种UTF的特质：</h2><h3 id="UTF-32"><a href="#UTF-32" class="headerlink" title="UTF-32:"></a>UTF-32:</h3><p>&emsp;&emsp;最清楚的一个UTF，每个码点用32位表示，大于Unicode的21位，所以每个UTF-32可以直接表示对应的码点。尽管简单，但不怎么使用，对空间浪费太大。</p>
<h3 id="UTF-16："><a href="#UTF-16：" class="headerlink" title="UTF-16："></a>UTF-16：</h3><p>&emsp;&emsp;UTF-16 编码介于 UTF-32与UTF-8之间，同时结合了定长和变长两种编码方法的特点。它的编码规则很简单：基本平面的字符占用 2 个字节，辅助平面的字符占用 4 个字节。也就是说，UTF-16 的编码长度要么是2个字节（U+0000到U+FFFF），要么是4个字节（U+010000到U+10FFFF）。那么问题来了，当我们遇到两个字节时，到底是把这两个字节当作一个字符还是与后面的两个字节一起当作一个字符呢？</p>
<p>&emsp;&emsp;这里有一个很巧妙的地方，在基本平面内，从 U+D800 到 U+DFFF 是一个空段，即这些码点不对应任何字符。因此，这个空段可以用来映射辅助平面的字符。</p>
<p>&emsp;&emsp;辅助平面的字符位共有 2^20 个，因此表示这些字符至少需要 20 个二进制位。UTF-16 将这 20 个二进制位分成两半，前 10 位映射在 U+D800 到 U+DBFF，称为高位（H），后 10 位映射在 U+DC00 到 U+DFFF，称为低位（L）。这意味着，一个辅助平面的字符，被拆成两个基本平面的字符表示。</p>
<p>&emsp;&emsp;因此，当我们遇到两个字节，发现它的码点在 U+D800 到 U+DBFF 之间，就可以断定，紧跟在后面的两个字节的码点，应该在 U+DC00 到 U+DFFF 之间，这四个字节必须放在一起解读。</p>
<p>&emsp;&emsp;接下来，以汉字”𠮷”为例，说明 UTF-16 编码方式是如何工作的。</p>
<p>&emsp;&emsp;汉字”𠮷”的 Unicode 码点为 0x20BB7，该码点显然超出了基本平面的范围（0x0000 - 0xFFFF），因此需要使用四个字节表示。首先用 0x20BB7 - 0x10000 计算出超出的部分，然后将其用 20 个二进制位表示（不足前面补 0 ），结果为0001000010 1110110111。接着，将前 10 位映射到 U+D800 到 U+DBFF 之间，后 10 位映射到 U+DC00 到 U+DFFF 即可。U+D800 对应的二进制数为 1101100000000000，直接填充后面的 10 个二进制位即可，得到 1101100001000010，转成 16 进制数则为 0xD842。同理可得，低位为 0xDFB7。因此得出汉字”𠮷”的 UTF-16 编码为 0xD842 0xDFB7。</p>
<h3 id="UTF-8："><a href="#UTF-8：" class="headerlink" title="UTF-8："></a>UTF-8：</h3><p>&emsp;&emsp;UTF-8 使用一到四个字节来编码一个码点。从 0 到 127 的这些码点直接映射成 1 个字节（对于只包含这个范围字符的文本来说，这一点使得 UTF-8 和 ASCII 完全相同）。接下来的 1,920 个码点映射成 2 个字节，在 BMP 里所有剩下的码点需要 3 个字节。Unicode 的其他平面里的码点则需要 4 个字节。UTF-8 是基于 8 位的码元的，因此它并不需要关心字节顺序（因为字节就是 8 位的呀，其它 UTF-16 和 UTF-32 在不同的机器编译环境下需要考虑字节的顺序问题）。</p>
<p><strong>编码规则如下：</strong></p>
<p>&emsp;&emsp;对于单个字节的字符，第一位设为 0，后面的 7 位对应这个字符的 Unicode 码点。因此，对于英文中的 0 - 127 号字符，与 ASCII 码完全相同。这意味着 ASCII 码那个年代的文档用 UTF-8 编码打开完全没有问题。</p>
<p>&emsp;&emsp;对于需要使用 N 个字节来表示的字符（N &gt; 1），第一个字节的前 N 位都设为 1，第 N + 1 位设为0，剩余的 N - 1 个字节的前两位都设位 10，剩下的二进制位则使用这个字符的 Unicode 码点来填充。</p>
<p>&emsp;&emsp;1字节 [0000 0000 - 0000 007F] 0xxxxxxx<br>&emsp;&emsp;2字节 [0000 0080 - 0000 07FF] 110xxxxx 10xxxxxx<br>&emsp;&emsp;3字节 [0000 0800 - 0000 FFFF] 1110xxxx 10xxxxxx 10xxxxxx<br>&emsp;&emsp;4字节 [0001 0000 - 0010 FFFF] 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx </p>
<p>&emsp;&emsp;“汉”的 Unicode 码点是 0x6c49（110 1100 0100 1001），通过上面的对照表可以发现，0x0000 6c49 位于第三行的范围，那么得出其格式为 1110xxxx 10xxxxxx 10xxxxxx。接着，从“汉”的二进制数最后一位开始，从后向前依次填充对应格式中的 x，多出的 x 用 0 补上。这样，就得到了“汉”的 UTF-8 编码为 11100110 10110001 10001001，转换成十六进制就是 0xE6 0xB7 0x89。</p>
<p>&emsp;&emsp;解码的过程也十分简单：如果一个字节的第一位是 0 ，则说明这个字节对应一个字符；如果一个字节的第一位1，那么连续有多少个 1，就表示该字符占用多少个字节。</p>
<h4 id="关于BOM头的问题："><a href="#关于BOM头的问题：" class="headerlink" title="关于BOM头的问题："></a>关于BOM头的问题：</h4><p>&emsp;&emsp;当你新建一个 文本文档 之后，在里面输入 “联通” 两个字，然后保存。当你再次打开的时候，原来输入的 “联通” 会变成两个乱码。这个问题就是因为 GB2312 编码与 UTF8 编码产生了编码冲撞造成的。<br>记事本的编码默认是ANSI, 如果你在ANSI的编码输入汉字，那么他实际就是GB系列的编码方式，在这种编码下，“联通”的第一二个字节、第三四个字节的起始部分的都是”110″和”10″，正好与UTF8规则里的两字节模板是一致的，于是再次打开记事本 时，记事本就误认为这是一个UTF8编码的文件。</p>
<p>&emsp;&emsp;当使用类似 WINDOWS 自带的记事本等软件，在保存一个以UTF-8编码的文件时，会在文件开始的地方插入三个不可见的字符（0xEF 0xBB 0xBF，即BOM）。它是一串隐藏的字符，用于让记事本等编辑器识别这个文件是否以UTF-8编码。这样就可以避免这个问题了。对于一般的文件，这样并不会产生什么麻烦。</p>
<p>&emsp;&emsp;这样做，也有弊处，尤其体现在网页中。PHP并不会忽略BOM，所以在读取、包含或者引用这些文件时，会把BOM作为该文件开头正文 的一部分。根据嵌入式语言的特点，这串字符将被直接执行（显示）出来。由此造成即使页面的 top padding 设置为0，也无法让整个网页紧贴浏览器顶部，因为在html一开头有这3个字符。如果你在网页中，发现了由未知的空白等，很有可能就是由于文件有 BOM 头造成的。遇到这种问题，把文件保存的时候，不要带有 BOM 头！</p>
<h4 id="MySql中UTF-8的问题"><a href="#MySql中UTF-8的问题" class="headerlink" title="MySql中UTF-8的问题"></a>MySql中UTF-8的问题</h4><p> &emsp;&emsp;最初的 UTF-8 格式使用一至六个字节，最大能编码 31 位字符。最新的 UTF-8 规范只使用一到四个字节，最大能编码21位，正好能够表示所有的 17个 Unicode 平面。<br> 低版本的MySQL支持的utf8编码，最大字符长度为 3 字节，如果遇到 4 字节的字符就会出现错误了。三个字节的 UTF-8 最大能编码的 Unicode 字符是 0xFFFF，也就是 Unicode 中的基本多文平面（BMP）。也就是说，任何不在基本多文平面的 Unicode字符，都无法使用MySQL原有的 utf8 字符集存储。这些不在BMP中的字符包括哪些呢？最常见的就是Emoji 表情（Emoji 是一种特殊的 Unicode 编码，常见于 ios 和 android 手机上），和一些不常用的汉字，以及任何新增的 Unicode 字符等等。</p>
<p> &emsp;&emsp;这可能是因为在MySQL发布初期，基本多文种平面之外的字符确实很少用到。而在MySQL5.5.3版本后，要在 Mysql 中保存 4 字节长度的 UTF-8 字符，就可以使用 utf8mb4 字符集了。例如可以用utf8mb4字符编码直接存储emoj表情，而不是存表情的替换字符。为了获取更好的兼容性，应该总是使用 utf8mb4 而非utf8，事实上，最新版的phpmyadmin默认字符集就是utf8mb4。</p>
<p> &emsp;&emsp;新建mysql库或者表的时候还有一个排序规则，utf8_unicode_ci比较准确，utf8_general_ci速度比较快。通常情况下 utf8_general_ci的准确性就够我们用的了，如果是utf8mb4那么对应的就是 utf8mb4_general_ci utf8mb4_unicode_ci。</p>
<p>&emsp;&emsp;UTF-8既然能保存那么多文字、符号，为什么国内还有这么多使用GBK等编码的人？因为UTF-8等编码体积比较大，占电脑空间比较多，如果面向的使用人群绝大部分都是中国人，用GBK等编码也可以。但是目前的电脑来看，硬盘都是白菜价，电脑性能也已经足够无视这点性能的消耗了。所以推荐所有的网页使用统一编码：UTF-8。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2019/03/16/Java的拆箱装箱与等值判断/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/16/Java的拆箱装箱与等值判断/" itemprop="url">Java的装箱拆箱与等值判断</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-16T00:00:00+08:00">
                2019-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Java的数据类型："><a href="#Java的数据类型：" class="headerlink" title="Java的数据类型："></a>Java的数据类型：</h3><p>为了迎合人类的习惯和加快常规数据的处理速度，Java提供了八种基本数据类型：byte，short，int，long，float，double，char，boolean。这八种基本类型都有相对应得包装类，除char对应的包装类名为Character，int为Integer外，其他所有对应的包装类名就是把首字母大写即可。<br><img src="/imgs/x7.jpg" alt="enter description here" title="java基本数据类型"></p>
<h3 id="装箱与拆箱"><a href="#装箱与拆箱" class="headerlink" title="装箱与拆箱"></a>装箱与拆箱</h3><p>Integer i = 10;  //装箱<br>int n = i;   //拆箱<br>在装箱的时候自动调用的是Integer的valueOf(int)方法。而在拆箱的时候自动调用的是Integer的intValue方法。<br>下面是Integer.java的源码：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i &gt;= <span class="number">-128</span> &amp;&amp; i &lt;= IntegerCache.high)　　<span class="comment">// 没有设置的话，IngegerCache.high 默认是127</span></span><br><span class="line">        <span class="keyword">return</span> IntegerCache.cache[i + <span class="number">128</span>];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>而其中IntegerCache类的实现为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntegerCache</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> high;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> Integer cache[];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> low = -<span class="number">128</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// high value may be configured by property</span></span><br><span class="line">            <span class="keyword">int</span> h = <span class="number">127</span>;</span><br><span class="line">            <span class="keyword">if</span> (integerCacheHighPropValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Use Long.decode here to avoid invoking methods that</span></span><br><span class="line">                <span class="comment">// require Integer's autoboxing cache to be initialized</span></span><br><span class="line">                <span class="keyword">int</span> i = Long.decode(integerCacheHighPropValue).intValue();</span><br><span class="line">                i = Math.max(i, <span class="number">127</span>);</span><br><span class="line">                <span class="comment">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class="line">                h = Math.min(i, Integer.MAX_VALUE - -low);</span><br><span class="line">            &#125;</span><br><span class="line">            high = h;</span><br><span class="line"></span><br><span class="line">            cache = <span class="keyword">new</span> Integer[(high - low) + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">int</span> j = low;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line">                cache[k] = <span class="keyword">new</span> Integer(j++);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">IntegerCache</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>从这2段代码可以看出，在通过valueOf方法创建Integer对象的时候，如果数值在[-128,127]之间，便返回指向IntegerCache.cache中已经存在的对象的引用；否则创建一个新的Integer对象。<br>事实上，Byte、Short、Long、Integer都会使用缓存，默认范围都为-128~127，浮点型没有实现缓存，Integer是唯一可以修改缓存范围的包装类，在VM options加入参数-XX:AutoBoxCacheMax=7777,即可设置最大缓存值为7777。<br>Character也有缓存，范围是(char)0~(char)127，而Boolean是使用的静态final变量，valueOf()返回的是静态值：<br><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">Boolean</span> valueOf(<span class="keyword">boolean</span> b) &#123;</span><br><span class="line">      <span class="keyword">return</span> (b ? <span class="keyword">TRUE</span> : <span class="keyword">FALSE</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">Boolean</span> <span class="keyword">TRUE</span> = <span class="keyword">new</span> <span class="keyword">Boolean</span>(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * The &lt;code&gt;Boolean&lt;/code&gt; object corresponding to the primitive </span></span><br><span class="line"><span class="comment">     * value &lt;code&gt;false&lt;/code&gt;. </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">Boolean</span> <span class="keyword">FALSE</span> = <span class="keyword">new</span> <span class="keyword">Boolean</span>(<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="等值判断"><a href="#等值判断" class="headerlink" title="等值判断"></a>等值判断</h3><p>equals() 比较的是两个对象的值（内容）是否相同。<br> “==” 比较的是两个对象的引用（内存地址）是否相同，也用来比较两个基本数据类型的变量值是否相等，包装类型和基本类型进行“==”比较时，包装类型会自动拆箱为基本数据类型。<br>int和Integer比较，Integer会自动拆箱，转换为int与int比较，显式的new Integer()会在堆中创建新的空间。<br><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">int i1 = <span class="number">1000</span>;</span><br><span class="line">int i2 = <span class="number">1000</span>;</span><br><span class="line"><span class="built_in">Integer</span> i3 = <span class="number">1000</span>;</span><br><span class="line"><span class="built_in">Integer</span> i4 = <span class="number">1000</span>;</span><br><span class="line"><span class="built_in">Integer</span> i5 = <span class="number">100</span>;</span><br><span class="line"><span class="built_in">Integer</span> i6 = <span class="number">100</span>;</span><br><span class="line"><span class="built_in">Integer</span> i7 = <span class="keyword">new</span> <span class="built_in">Integer</span>(<span class="number">100</span>);</span><br><span class="line"><span class="built_in">Integer</span> i8 = <span class="built_in">Integer</span>.valueOf(<span class="number">100</span>);</span><br><span class="line">System.<span class="keyword">out</span>.println(i1 == i2);	//<span class="literal">true</span></span><br><span class="line">System.<span class="keyword">out</span>.println(i2 == i3);	//<span class="literal">true</span></span><br><span class="line">System.<span class="keyword">out</span>.println(i3 == i4);	//<span class="literal">false</span></span><br><span class="line">System.<span class="keyword">out</span>.println(i5 == i6);	//<span class="literal">true</span></span><br><span class="line">System.<span class="keyword">out</span>.println(i6 == i7);	//<span class="literal">false</span></span><br><span class="line">System.<span class="keyword">out</span>.println(i5 == i8);	//<span class="literal">true</span></span><br><span class="line">System.<span class="keyword">out</span>.println(i7 == i8);	//<span class="literal">false</span></span><br><span class="line">      </span><br><span class="line">      <span class="built_in">boolean</span> b1 = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">boolean</span> b2 = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">Boolean</span> b3 = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">Boolean</span> b4 = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">Boolean</span> b5 = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="built_in">Boolean</span> b6 = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>);</span><br><span class="line">System.<span class="keyword">out</span>.println(b1 == b2);	//<span class="literal">true</span></span><br><span class="line">System.<span class="keyword">out</span>.println(b2 == b3);	//<span class="literal">true</span></span><br><span class="line">System.<span class="keyword">out</span>.println(b3 == b4);	//<span class="literal">true</span></span><br><span class="line">System.<span class="keyword">out</span>.println(b4 == b5);	//<span class="literal">false</span></span><br><span class="line">System.<span class="keyword">out</span>.println(b5 == b6);	//<span class="literal">false</span></span><br><span class="line">      System.<span class="keyword">out</span>.println(b5.equals(b6));	//<span class="literal">true</span></span><br><span class="line">      </span><br><span class="line">      <span class="built_in">String</span> s1 = <span class="string">"abc"</span>;</span><br><span class="line"><span class="built_in">String</span> s2 = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">"abc"</span>);</span><br><span class="line"><span class="built_in">String</span> s3 = <span class="string">"abc"</span>;</span><br><span class="line">System.<span class="keyword">out</span>.println(s1 == s2);	//<span class="literal">false</span></span><br><span class="line">System.<span class="keyword">out</span>.println(s1 == s3);	//<span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>采用字面值的方式创建一个字符串时，JVM首先会去字符串池中查找是否存在”abc”这个对象，如果不存在，则在字符串池中创建”abc”这个对象，然后将池中”abc”这个对象的引用地址返回给字符串常量str，这样str会指向池中”abc”这个字符串对象；如果存在，则不创建任何对象，直接将池中”abc”这个对象的地址返回，赋给字符串常量。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2018/12/11/浅谈线性存储结构/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/11/浅谈线性存储结构/" itemprop="url">浅谈线性数据结构</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-11T00:00:00+08:00">
                2018-12-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><p>数据存储于计算机的内存中。内存如下图所示，形似排成列的箱子，1个箱子里存储一个数据。<br>数据存储于内存时，决定了数据顺序和位置关系的便是“数据结构”。<br><img src="/imgs/12-11/内存.png" alt="enter description here" title="内存"><br>  数据在计算机中有两种基本的存储结构，分别是顺序存储结构和链式存储结构。<br>  顺序结构是依靠元素的相对位置来表示数据元素之间的逻辑关系，需要存储在一片连续的存储空间中。链式结构是依靠为每个节点附加指针字段，用于指出后续元素的存储地址，无需连续空间，但空间开销大。<br><img src="/imgs/12-11/结构.png" alt="enter description here" title="结构"></p>
<p>  线性结构就是一个有序数据元素的集合，数据元素之间是<strong>一对一</strong>的关系。</p>
<h3 id="线性存储结构"><a href="#线性存储结构" class="headerlink" title="线性存储结构"></a>线性存储结构</h3><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>  数组存储在<strong>连续</strong>的单元中，通过数组下标可直接访问，读取速度很快。但如果想在任意位置添加和删除元素就很复杂，需要挪动数组元素，添加还要确保数组有剩余的空间。</p>
<h4 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h4><p>  链表中的元素分散存储在内存中，通过指针相关联。数据的添加和删除较为方便，就是访问比较耗费时间。在链表中，添加和删除操作只要通过修改指针就可以完成。</p>
<p>  在链表尾部添加指向头部的指针，便是“循环链表”。每个元素都设置两个指针指向前后，便是“双向链表”。双向链表空间消耗大，修改时需要更改更多指针的指向。</p>
<h4 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h4><p>  在栈中，最后添加的数据最先被取出，即“后进先出”（Last In First Out），简称LIFO。<br>  与数组和链表一样，栈也是线性排列，但栈的操作只能在一端进行，只能访问顶端的数据，想访问中间的数据只有将上面的依次出栈才行。<br><img src="/imgs/12-11/栈.png" alt="enter description here" title="栈"></p>
<h4 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h4><p>  队列与栈有些相似，但队列的操作分别在两端进行，一端进一端出。就像排队一样，队列是“先进先出”的结构（First In Last Out），简称FILO。队列与栈相似，不能直接访问位于中间的数据，必须通过出队将元素变为首位才能访问。<br><img src="/imgs/12-11/队列.png" alt="enter description here" title="队列"></p>
<h4 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h4><p>  哈希表（Hash table，也叫散列表），是根据关键码值(Key value)而直接进行访问的数据结构。也就是说，它通过把关键码值映射到表中一个位置来访问记录，以加快查找的速度。这个映射函数叫做哈希函数，存放记录的数组叫做哈希表。</p>
<p>  哈希表通过哈希函数计算出键的哈希值取模进行存入和取出，多个元素最后的哈希值相同就会<strong>产生冲突</strong>。处理冲突的方法与散列表的组织形式有关，通常有两大类：开放地址法、链地址法。<br>  <strong>开放地址法</strong>：发生冲突时，采取合适方法计算得到另一个哈希值，知道不发生冲突。<br>  <strong>链地址法</strong>：将相同哈希值的记录放在同一个单链表中，称为同义词链表，用数组存放各个链表的头指针。<br><img src="/imgs/12-11/链地址法.png" alt="enter description here" title="链地址法"></p>
<p>  在哈希表中，利用哈希函数可以快速访问数组中的目标数据，如果冲突可以使用链表进行存储，这样就能灵活应对大量的数据。如果数组太小容易发生冲突，线性查找的频率也高；反过来，数组太大就会有很多空间浪费，因此给数组<strong>设定合适的空间</strong>很重要。<br>  因为哈希表在数据存储的灵活性和数据查询的高效性，关联数组等常常会使用它。</p>
<h4 id="串（字符串）"><a href="#串（字符串）" class="headerlink" title="串（字符串）"></a>串（字符串）</h4><p> 串（String）是由零个或多个字符组成的有限序列，一般记为：s=”a1a2…an”(n&gt;=0)<br> 其中，s是<strong>串名</strong>，双引号中是串的<strong>值</strong>；ai可以是字母、数字或其他字符；n是串的<strong>长度</strong>。零个字符的是<strong>空串</strong>；由一个或多个空格组成的串“ ”称为<strong>空格串</strong>。串中任意个连续的字符组成的子序列称为该串的<strong>子串</strong>，包含子串的串为<strong>主串</strong>。通常称字符在序列中的序号为该字符在串中的<strong>位置</strong>。子串的位置则以<strong>第一个</strong>字符在主串中的位置来表示。</p>
<p> 串有三种存储方式：定长顺序存储表示、堆分配表示（比较倾向使用这种）、链式存储表示。</p>
<p> 线性表大多以“单个元素”作为操作对象，而在串的基本操作中，通常以“<strong>串的整体</strong>”作为操作对象，例如，判断串是否相等、求串长度、串联结 Concat、取子串Substr、串置换 Replace、定位Index、插入、删除、判空、模式匹配等。</p>
<p> 著名的模式匹配算法有BF算法和KMP算法。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p> 数据结构往往同高效的检索算法和索引技术有关。通常情况下，精心选择的数据结构可以带来更高的运行或者存储效率。</p>
<p> 数组访问效率高，难于添加删除。</p>
<p> 链表添加删除快，访问太慢。</p>
<p> 栈是后进先出，队列是先进先出，两者都不能直接访问中间的元素。</p>
<p> 哈希表操作相比数组和链表，比较平衡。并且能存储键值对。</p>
<p> 串是专门处理字符序列的，通常以“串的整体”作为操作对象。</p>
<p> 在实际的编程中，我们应该根据需求灵活的选择存储数据的结构。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2018/12/04/走出舒适区/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/04/走出舒适区/" itemprop="url">走出舒适区</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-04T00:00:00+08:00">
                2018-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/刻意练习/" itemprop="url" rel="index">
                    <span itemprop="name">刻意练习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>当你总是感觉轻松如意的时候,要么你就是在搭顺风车,要么你就是在走下坡路。</p>
<h3 id="一万小时法则的错与对"><a href="#一万小时法则的错与对" class="headerlink" title="一万小时法则的错与对"></a>一万小时法则的错与对</h3><p>作家格拉德威尔在《异类》一书中指出：<br>人们眼中的天才之所以卓越非凡，并非天资超人一等，而是付出了持续不断的努力。1万小时的锤炼是任何人从平凡变成超凡的必要条件。”<br>“他将此称为”一万小时定律”。要成为某个领域的专家，需要10000小时，按比例计算就是:如果每天工作八个小时，一周工作五天，那么成为一个领域的专家至少需要五年。这就是一万小时定律。</p>
<h4 id="错在哪里"><a href="#错在哪里" class="headerlink" title="错在哪里"></a>错在哪里</h4><p>最近几年一万小时这个概念非常热门，但<b>实际上从来不存在一万小时定律，它仅仅是畅销书作家对心理学研究的一次不太严谨的演绎而已</b>，大多数人都不知道，“刻意练习”下的一万小时才有用。把现在的日常事务努力重复1000天，并不能让你成为专家，只会让你在现状中陷得更深。<br>这一法则具有无法抗拒的吸引力。它很容易被记住。它满足了人类发现某种简单的因果关系的渴望：只要你在任何一件事情上花一万小时来练习，就会成为大师。<br>不幸的是，这一法则在许多方面都是错的，我们今天的很多人只是认为，如果确实练习了一万个小时，那就真能达到这种效果。<br>尽管格拉德威尔本人并没有说，但许多人把它解释为一种承诺，也就是说，在任何一个行业或领域，只要做到一万小时的练习，几乎人人都成为该行业或领域的专家。<br>首先，一万小时并没有什么特别或神奇之处；而且，这个数目也因行业的不同而不同；其次，<b>一般的练习与刻意练习是有区别的</b>，而且这种区别十分关键。</p>
<h4 id="对在哪里"><a href="#对在哪里" class="headerlink" title="对在哪里"></a>对在哪里</h4><p>在任何一个有着悠久历史的行业或领域，要想成就一番事业，致力于变成业内的杰出人物，需要付出许多年艰苦卓绝的努力。也许并不需要恰好一万小时的练习，但要花很长时间练习。<br>作家和诗人通常在他们的最杰出作品推出前，写作了逾10年时间；从科学家首次发表科技成果，到他发表最重要的科技成果，通常也要经历10多年的磨练；从一个人开始学习音乐算起，到他写出一首真正杰出的乐曲，平均需要20年的时间，一般也不会少于10年。<br>只要以正确的方式训练，人们提高自身绩效和表现的能力将是巨大无比的。如果你练习做某件事几百个小时，几乎可以肯定，你能看到巨大的进步。但那还只是“万里长征迈出的第一步”，你可以坚持、坚持、再坚持，使你自己变得卓越、卓越、更卓越，你的进步有多大，取决你自己。<br>人们的绩效或表现的提高，并不存在极限，而更多的练习不一定会带来更大的进步。因此，如果你希望成为你所在的高度竞争行业或领域中的世界上最杰出人物，就得付出成千上万个小时的艰苦努力，只为了与那些在同类工作中同样勤学苦练的人有平等竞争的机会。<br>随着训练方法的改进和人类的成就达到了全新的高度，在任何一个人类付出了努力的行业或领域，都在持续不断地出现变得更加卓越的方法，以抬高人们认为可以做到的“门槛”，而且，并没有迹象表明这样的“门槛”将不能再抬高。每当人类发展至新的一代，潜力的界限也随之扩张和提高。</p>
<h3 id="刻意练习的特点"><a href="#刻意练习的特点" class="headerlink" title="刻意练习的特点"></a>刻意练习的特点</h3><p>上文所提到的“刻意练习”有四个特点：<br>1、具有定义明确的特定目标<br>定义明确的目标，可以有效地用于引导练习。<br>2、刻意练习是专注的<br>要想取得进步，必须完全把注意力集中在你的任务上。<br>3、刻意练习包含反馈<br>你必须知道某件事情自己做得对不对，如果不对，错在哪？<br>4、需要走出舒适区<br>对于任何类型的练习，这是一条基本的真理：如果你从来不迫使自己走出舒适区，便永远无法进步。</p>
<h3 id="走出舒适区的重要性"><a href="#走出舒适区的重要性" class="headerlink" title="走出舒适区的重要性"></a>走出舒适区的重要性</h3><h4 id="身体偏爱稳定性"><a href="#身体偏爱稳定性" class="headerlink" title="身体偏爱稳定性"></a>身体偏爱稳定性</h4><p><b>人类的身体有一种偏爱稳定性的倾向。</b>它使我们身体日复一日的保持合理的一致（血压、心率、血糖、PH值），当然，所有这些全都不是完全静态的。例如，锻炼会使心率加快、暴饮暴食会使体重增加、节食会使体重下降等等。但这些变化通常是暂时的，而身体最终会回到它原来的模样。对于这种现象，技术上的术语是“体内平衡”。<br>因此，身体需要各种各样反馈机制的支持，这些反馈机制着力于维持现状。当进行某种强有力的体育活动时，随着血流中的氧含量和能量供应量下降，身体需要采取各种措施来响应：心跳开始加快以增加血液中的氧含量并排放更多的二氧化碳、体内存储的不同能量都转换成可用能量并注入到血流中、血液循环加快以便更好地传输能量。只要体育锻炼并非费力到让身体的体内平衡机制无法正常运行，那么它基本不会引起身体上的生理变化。从身体的角度来看，它没有理由改变，一切还是照常运转。</p>
<h4 id="被迫走出舒适区之后"><a href="#被迫走出舒适区之后" class="headerlink" title="被迫走出舒适区之后"></a>被迫走出舒适区之后</h4><p>超出界限后，你的身体系统和细胞自身会处在异常状态下。细胞对这种状态的改变不满意，他们通过升高细胞DNA中的一些不同的基因来响应。而身体肌肉对此的顺应方式是：变得足够强壮，以建立新的舒适区，这样就重新建立了体内平衡。<br>这就是体育锻炼制造身体变化的一般模式。当身体的系统感受到压力，以至于原来的体内平衡无法继续保持下去时，身体便会开始响应那些变化，目的是重新建立体内平衡。<br>这也有一个陷阱：一旦重新建立体内平衡，那么身体就能轻松应对以前感到十分艰难的那些体育锻炼活动了，它会再度感到舒服，改变也停止了。因此，要使改变不断进行下去，你必须不断地加码：跑得更远一些、更快一些，并且爬坡跑。<br>如果你不继续给自己施加一些压力，身体将会保持体内平衡，尽管此时的体内平衡不同于以前，但你将停下改进的脚步。</p>
<h4 id="挑战越大，变化越大，但不要太过"><a href="#挑战越大，变化越大，但不要太过" class="headerlink" title="挑战越大，变化越大，但不要太过"></a>挑战越大，变化越大，但不要太过</h4><p>这解释了持续将自己推出舒适区的重要性：你要使身体的补偿变化不停的发生，但如果一下子推得太猛，使自己远远地离开了舒适区，就有可能受伤，事实上反而阻碍了你的提高。<br>一个人遇到的挑战越大，在一定程度上，大脑中的变化也越大。研究表明，人在学习一项新的技能时，如果能够触发大脑结构的变化，那么这种学习比起只是继续练习已学会的某项技能时的学习要高效得多。另一方面，在过长的时间内过分地逼迫自己，可能导致倦怠和学习低效。<br><b>大脑和身体一样，对于处在舒适区之外却离得并不太远的“甜蜜点”上的挑战，改变得最为迅速。</b></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2017/05/17/ajax的封装/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/17/ajax的封装/" itemprop="url">ajax的封装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T23:16:55+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Ajax介绍"><a href="#Ajax介绍" class="headerlink" title="Ajax介绍"></a>Ajax介绍</h3><h4 id="什么是Ajax？"><a href="#什么是Ajax？" class="headerlink" title="什么是Ajax？"></a>什么是Ajax？</h4><p>AJAX = Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）。<br>AJAX技术的核心是XMLHttpRequest对象（简称XHR），虽然名字中包含XML的成分，但Ajax通信与数据格式无关；这种技术就是无须刷新页面即可从服务器取得数据，但不一定是XML数据。</p>
<h4 id="XMLHttpRequest对象"><a href="#XMLHttpRequest对象" class="headerlink" title="XMLHttpRequest对象"></a>XMLHttpRequest对象</h4><p>所有现代浏览器（IE7+、Firefox、Chrome、Safari 以及 Opera）均内建 XMLHttpRequest 对象:<br>variable=new XMLHttpRequest();<br>IE5、IE6不支持XMLHttpRequest对象，而是使用ActiveX 对象：<br>variable=new ActiveXObject(“Microsoft.XMLHTTP”);<br>所以最好用if判断，处理IE的兼容性：<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xmlhttp;</span><br><span class="line"><span class="keyword">if</span> (window.XMLHttpRequest)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码</span></span><br><span class="line">    xmlhttp=<span class="keyword">new</span> <span class="type">XMLHttpRequest</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// IE6, IE5 浏览器执行代码</span></span><br><span class="line">    xmlhttp=<span class="keyword">new</span> <span class="type">ActiveXObject</span>(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>window属性未定义返回undefined，变量未定义会出错，所以if条件要用属性形式</strong></p>
<h4 id="XHR的用法："><a href="#XHR的用法：" class="headerlink" title="XHR的用法："></a>XHR的用法：</h4><p>open()：接收三个参数：请求的类型（‘GEt’、‘POST’）、请求的url（绝对、相对）、是否异步（true、false）<br>例如：xhr.open(“get”,”example.php”,ture);<br>调用open()方法并不会真正发送请求，而只是启动一个请求以备发送。<br><b>注意：只能向同一个域中使用相同端口和协议的URL发送请求。（同源策略）</b><br><a href="http://ning101.cn/2017/05/16/简单的json/">http://ning101.cn/2017/05/16/简单的json/</a> 这篇文章最后有利用script的src属性绕过同源策略的代码</p>
<p><strong>send()</strong>：接收一个参数，作为请求主体发送的数据。如果不需要通过请求主体发送数据，则必须传入null，调用send()之后，请求就会被分派到服务器。<br>在接收到服务器相应后，相应的数据会自动填充XHR对象的属性：<br><strong>responseText</strong>: 请求成功后返回的数据<br><strong>status</strong>: 相应的HTTP状态<br>接收相应后，先检查status属性，状态吗200为成功，304表示请求的资源未被修改（意味响应有效）</p>
<p>发送异步请求时，应该检测XHR的readyState属性，属性值取<strong>4</strong>时表示已接收到全部数据，可以使用<br>必须在调用open()之前指定onreadyStatechange事件处理才能确保跨浏览器兼容性</p>
<h3 id="Ajax的函数封装"><a href="#Ajax的函数封装" class="headerlink" title="Ajax的函数封装"></a>Ajax的函数封装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">function ajax(url,fnsucc,fnfail) &#123;</span><br><span class="line">    var xmlhttp = null;</span><br><span class="line">    if(window.XMLHttpRequest) &#123;</span><br><span class="line">        //IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码</span><br><span class="line">        xmlhttp = new XMLHttpRequest();</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        //IE6, IE5 浏览器执行代码</span><br><span class="line">        xmlhttp = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">				</span><br><span class="line">    xmlhttp.onreadystatechange = function()&#123;</span><br><span class="line">        if(xmlhttp.status == 200 &amp;&amp; xmlhttp.readyState == 4) &#123;</span><br><span class="line">            //请求成功调用函数</span><br><span class="line">            fnsucc(xmlhttp.responseText);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            //请求失败调用失败函数</span><br><span class="line">            if(fnfail) &#123;</span><br><span class="line">                fnfail();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">				</span><br><span class="line">    xmlhttp.open(&apos;GET&apos;,url,true);</span><br><span class="line">    xmlhttp.send(null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以像这样简单调用：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ajax('example.text',function(<span class="name">str</span>)&#123;</span><br><span class="line">    alert(<span class="name">str</span>)<span class="comment">;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2017/05/16/简单的json/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/16/简单的json/" itemprop="url">简单的json</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T19:03:50+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是json"><a href="#什么是json" class="headerlink" title="什么是json?"></a>什么是json?</h3><p>JSON&#40;JavaScript Object Notation&#41;一种轻量级的<strong>数据交换格式</strong>，具有良好的可读和便于快速编写的特性。可在不同平台之间进行数据交换。JSON采用兼容性很高的、完全独立于语言的<strong>文本格式</strong>，同时也具备类似于C语言的习惯&#40;包括C,C++,C#,Java,JavaScript,Perl,Python等&#41;体系的行为。这些特性使JSON成为理想的<strong>数据交换语言</strong>。</p>
<h3 id="JSON的优点："><a href="#JSON的优点：" class="headerlink" title="JSON的优点："></a>JSON的优点：</h3><p>A.数据格式比较简单，易于读写，格式都是压缩的，占用带宽小；<br>B.易于解析，客户端JavaScript可以简单的通过eval&#40;&#41;进行JSON数据的读取；<br>C.支持多种语言，包括ActionScript, C, C#, ColdFusion, Java, JavaScript, Perl, PHP, Python, Ruby等服务器端语言，便于服务器端的解析；<br>D.在PHP世界，已经有PHP-JSON和JSON-PHP出现了，偏于PHP序列化后的程序直接调用，PHP服务器端的对象、数组等能直接生成JSON格式，便于客户端的访问提取；<br>E.因为JSON格式能直接为服务器端代码使用，大大简化了服务器端和客户端的代码开发量，且完成任务不变，并且易于维护。
　　</p>
<h3 id="JSON的语法"><a href="#JSON的语法" class="headerlink" title="JSON的语法"></a>JSON的语法</h3><p><strong>JSON 是 JS 对象的字符串表示法，它使用文本表示一个 JS 对象的信息，本质是一个字符串。</strong><br>JSON可以表示三种类型的值：<br><strong>简单值</strong>：5，”hello world”（必须使用双引号，支持布尔和null）<br><strong>对象</strong>：&#123;”name”:”ning”,”age”:20&#125;（<strong>属性加双引号</strong>，冒号分割键值，没有声明变量，末尾没分号）<br><strong>数组</strong>：[25,”hi”,true]（采用JS的数组字面量形式，没有变量和分号）</p>
<h4 id="复杂的数据集合（数组-对象）"><a href="#复杂的数据集合（数组-对象）" class="headerlink" title="复杂的数据集合（数组+对象）:"></a>复杂的数据集合（数组+对象）:</h4><p>&#123;&#123;”name”:[“tang”,”ning”]&#125;,&#123;”age”:[19,20]&#125;&#125;<br>[&#123;”name”:”ning”&#125;,&#123;”age”:20&#125;]</p>
<h4 id="JSON的解析与序列化"><a href="#JSON的解析与序列化" class="headerlink" title="JSON的解析与序列化"></a><strong>JSON的解析与序列化</strong></h4><p>eval&#40;&#41;：JSON是JavaScript语法的子集，因此eval&#40;&#41;函数可以解析、解释并返回JavaScript对象和数组。（有风险，可能会执行一些恶意代码）<br>全局对象JSON的方法：<br><strong>JSON.stringify&#40;&#41;</strong>：将JavaScript对象序列化为JSON字符串（默认不包含空格字符或缩进函数及原型成员被忽略&#40;还有undefined&#41;）<br>　　1.过滤结果<br>　　第二个参数如果是数组，则结果中只包含数组中列出的属性<br>　　第二个参数如果是函数，则函数接收两个参数（属性名和属性值）。属性名只能是字符串，非键值对儿结构的键名可以是空字符串。<strong>函数返回的值就是相应键的值</strong>（返回undefined则忽略该属性）。<br>　　2.字符串缩进<br>　　第三个参数用于控制结果中的缩进和空白符。如果是数值（最大为10），则表示每个级别缩进的空格数。只要传入有效的值，结果中会包含换行符。<br>　　如果参数是字符串，则这个字符串被用作缩进字符（不再使用空格），字符串长度取10<br><strong>JSON.parse&#40;&#41;</strong>：将JSON字符串解析为原生JavaScript值，如果传给JSON.parse&#40;&#41;的字符串不是有效的JSON，该方法会抛出错误。<br>　　过滤结果：（如过滤Date对象）<br>　　该方法接收另一个参数，称为还原函数。与JSON.stringify&#40;&#41;的过滤函数相同。
　　</p>
<h3 id="Ajax获取JSON数据"><a href="#Ajax获取JSON数据" class="headerlink" title="Ajax获取JSON数据"></a>Ajax获取JSON数据</h3><p><strong>HTML内的JS代码</strong>：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var jsonText = new XMLHttpRequest();</span><br><span class="line">jsonText.onreadystatechange=function()&#123;</span><br><span class="line"><span class="code">	if(jsonText.readyState==4 &amp;&amp; jsonText.status==200)&#123;</span></span><br><span class="line"><span class="code">		var str = JSON.parse(jsonText.responseText);</span></span><br><span class="line"><span class="code">		alert(str);</span></span><br><span class="line"><span class="code">	&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">jsonText.open('GET','json.json',true);</span><br><span class="line">jsonText.send(null);</span><br></pre></td></tr></table></figure>
<p><b>json.json代码</b>：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="code">	"name":["aa","bb","cc","dd"],</span></span><br><span class="line"><span class="code">	"age":[12,23,34,45]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>HTML内的JS代码</strong>：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var phpText = new XMLHttpRequest();</span><br><span class="line">phpText.onreadystatechange=function()&#123;</span><br><span class="line"><span class="code">	if(phpText.readyState==4 &amp;&amp; phpText.status==200)&#123;</span></span><br><span class="line"><span class="code">		var str = JSON.parse(phpText.responseText);</span></span><br><span class="line"><span class="code">		alert(str);</span></span><br><span class="line"><span class="code">	&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">phpText.open('POST','json.php',true);</span><br><span class="line">phpText.send(null);</span><br></pre></td></tr></table></figure>
<p><b>json.php代码</b>：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="php"><span class="meta">&lt;?php</span></span></span></span><br><span class="line"><span class="xml">	header('Content-Type: application/json');</span></span><br><span class="line"><span class="xml">	$arr = array('a'=&gt;</span>1,'b'=&gt;2,'c'=&gt;3);</span><br><span class="line">//	$arr = '&#123;"a":1,"b":2,"c":3&#125;';</span><br><span class="line"><span class="code">	$jsonstring = json_encode($arr);</span></span><br><span class="line"><span class="code">	echo $jsonstring;</span></span><br><span class="line">//	echo $arr;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h3 id="跨域获取JSON数据"><a href="#跨域获取JSON数据" class="headerlink" title="跨域获取JSON数据"></a>跨域获取JSON数据</h3><p><strong>HTML内的JS代码</strong>：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span></span><br><span class="line">function callbackFunction(result)&#123;</span><br><span class="line">　　for(var i=0;i<span class="xml"><span class="tag">&lt;<span class="name">result.length;i++)&#123;</span></span></span></span><br><span class="line"><span class="xml">　　　　alert(result[i]);</span></span><br><span class="line"><span class="xml">　　&#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"callback.php?callback=callbackFunction"</span>&gt;</span><span class="undefined"></span></span><span class="xml"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p><b>callback.php代码</b>：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="php"><span class="meta">&lt;?php</span></span></span></span><br><span class="line"><span class="xml">	header('Content-type:application/json');</span></span><br><span class="line"><span class="xml">	$jsoncallback = htmlspecialchars($_REQUEST['callback']);</span></span><br><span class="line"><span class="xml">	$json_data='["result1","result2","result3"]';</span></span><br><span class="line"><span class="xml">	echo $jsoncallback."(".$json_data.")";</span></span><br><span class="line"><span class="xml">?&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="以上代码地址：https-github-com-ning101-js-effects-tree-master-json"><a href="#以上代码地址：https-github-com-ning101-js-effects-tree-master-json" class="headerlink" title="以上代码地址：https://github.com/ning101/js-effects/tree/master/json"></a>以上代码地址：<a href="https://github.com/ning101/js-effects/tree/master/json" target="_blank" rel="noopener">https://github.com/ning101/js-effects/tree/master/json</a></h4>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2017/05/03/建立github+hexo博客要点总结/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/03/建立github+hexo博客要点总结/" itemprop="url">建立github+hexo博客要点总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-03T21:16:55+08:00">
                2017-05-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/环境搭建/" itemprop="url" rel="index">
                    <span itemprop="name">环境搭建</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3>搭建环境</h3><br><h4>—-Git</h4><br><br>安装msysGit(组件可选择Use Git Bash only),然后在Git Bash中使用Git。<br><h4>—-node.js</h4><br><br>到node.js官网下载最新版本安装。<br><h4>—-github</h4><br><br>注册github帐号,建立用户名.github.io仓库。<br><h4>—-ssh key</h4><br><br>打开git bash，输入ssh-keygen -t rsa -C “邮件地址”再三次回车,打开.ssh\id_rsa.pub文件，记事本打开并复制里面的内容，打开github主页，进入setting -&gt; SSH and GPG keys，注意勾选Allow write access。<br><h4>—-git 配置</h4><br><br>打开git bash,输入$ git config –-global user.name “github用户名”和git config –-global user.email “github注册邮箱”。<br><h4>—-安装hexo</h4><br><br>打开git bash，输入$ npm install -g hexo。mkdir创建博客文件夹，cd打开文件夹,hexo init初始化–hexo g生成html文件–hexo s启动服务预览，浏览器打开<a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a> 即可看到内容。<br>常用命令<br><h4>—-Git Bash</h4><br><br>mkdir：跟文件夹名可创建文件夹<br>cd：cd 文件夹名或路径可以打开该文件夹，仅cd可打开主目录<br>init：要使用Git进行版本管理，必须git init初始化仓库<br>clone：git clone http地址或ssh-key,如git clone <a href="https://github.com/ning101/Hello-World.git" target="_blank" rel="noopener">https://github.com/ning101/Hello-World.git</a> 获取远程仓库<br>status：git status查看仓库的状态<br>add：git add向暂存区添加文件，-A添加全部<br>commit：git commit提交保存，-A提交全部，-m提交信息,如：git commit -m(A) “First commit”<br>log：git log查看提交日志<br>pull: git pull抓取远程仓库所有分支更新并合并到本地（仓库有更改后就要先pull再push上去）<br>push：git push推送至远程仓库<br><h4>—-hexo</h4><br><br>npm install hexo -g #安装<br>npm update hexo -g #升级<br>hexo init #初始化<br>hexo n “我的博客” == hexo new “我的博客” #新建文章<br>hexo new page “pageName” #新建页面<br>hexo g == hexo generate#生成静态页面<br>hexo s == hexo server #启动服务预览<br>hexo d == hexo deploy#部署至博客<br>ERROR Deployer not found: git错误：使用npm install hexo-deployer-git –save<br><h3>修改主题</h3><br><h4>—-找好主题</h4><br><br>可以到hexo官方<a href="https://hexo.io/themes/" target="_blank" rel="noopener">主题</a>选择自己喜欢的主题<br><h4>—-安装主题</h4><br><br>Git Bash打开博客目录，clone主题，如：git clone <a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">https://github.com/iissnan/hexo-theme-next</a> themes/next<br><h4>—-启用主题</h4><br><br>在站点 _config.yml中theme: 后输入next，注意冒号后要有一个空格<br><h4>—-更新主题</h4><br><br>cd themes/主题名<br>git pull origin master<br><h4>—-添加多说评论</h4><br><br>在多说中注册一个帐号，设置网站信息，复制通用代码<br>打开themes\light\layout_partial\comment.ejs文件，找到<br>&lt;% if (page.comments){ %&gt;<br><br>  这里要放置多说提供的通用代码  \<br>  &lt;% } %&gt;<br><h4>—-多说配置</h4><br><br>在主题_config.yml文件中添加多说的配置： duoshuo_shortname: 你站点的short_name<br><h3>绑定域名</h3><br><h4>—-购买域名</h4><br><br>可以到DNSPod、万网、易名等网站购买备案。<br><h4>—-添加域名</h4><br><br>到Github博客仓库(用户名.github.io)中创建CNAME文件(不要后缀名),填写二级域名,如:ning101.cn<br><h4>—-绑定域名</h4><br><br>首先到自己的域名管理页，点击你新买的域名，再点击添加记录按钮：<br>第一条：主机记录@，类型CNAME，记录值：用户名.github.io<br>第二条：主机记录www，类型CNAME，记录值同上<br>开始写作<br><h4>—-本地写作</h4><br><br>打开git bash，cd博客目录，hexo n “名字”创建.md文件，用编辑器打开编辑（记事本也行），编辑为markdown语法（也可用html语法），tags为文章标签，categories为分类。可通过hexo n page “页面名”来创建页面，通过域名/页面名访问页面。<br><h4>—-远程部署</h4><br><br>本地写完后,hexo g生成静态页面,hexo s可以在本地浏览器用<a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a> 预览,hexo d上传至github。<br><h3>注意事项</h3>

<p>要将CNAME文件放在本地博客目录下的public文件夹下（也可以直接在该文件创建CNAME文件），否则每次hexo d都会清楚github上面的CNAME文件。<br>更新主题后要使用npm install hexo-deployer-git –save命令重置才能使用hexo命令。</p>
<p>如果您发现上述有错误的地方或者有更好的建议，请在下方留言说明，感谢阅读。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2017/04/26/80-应聘者都不及格的-JS-面试题/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/26/80-应聘者都不及格的-JS-面试题/" itemprop="url">80%应聘者都不及格的JS面试题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-26T21:40:04+08:00">
                2017-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="不起眼的开始"><a href="#不起眼的开始" class="headerlink" title="不起眼的开始"></a>不起眼的开始</h3><p>招聘前端工程师，尤其是中高级前端工程师，扎实的 JS 基础绝对是必要条件，基础不扎实的工程师在面对前端开发中的各种问题时大概率会束手无策。在考察候选人 JS 基础的时候，我经常会提供下面这段代码，然后让候选人分析它实际运行的结果：</p>
<p><b>for (var i = 0; i &lt; 5; i++) {<br>    setTimeout(function() {<br>        console.log(new Date, i);<br>    }, 1000);<br>}</b></p>
<p>console.log(new Date, i);<br>这段代码很短，只有 7 行，我想，能读到这里的同学应该不需要我逐行解释这段代码在做什么吧。候选人面对这段代码时给出的结果也不尽相同，以下是典型的答案：</p>
<ul>
<li>A. 20% 的人会快速扫描代码，然后给出结果：0,1,2,3,4,5；</li>
<li>B. 30% 的人会拿着代码逐行看，然后给出结果：5,0,1,2,3,4；</li>
<li>C. 50% 的人会拿着代码仔细琢磨，然后给出结果：5,5,5,5,5,5；<br>只要你对 JS 中同步和异步代码的区别、变量作用域、闭包等概念有正确的理解，就知道正确答案是 <strong>C</strong>，代码的实际输出是：</li>
</ul>
<p><b>2017-03-18T00:43:45.873Z 5<br>2017-03-18T00:43:46.866Z 5<br>2017-03-18T00:43:46.868Z 5<br>2017-03-18T00:43:46.868Z 5<br>2017-03-18T00:43:46.868Z 5<br>2017-03-18T00:43:46.868Z 5</b><br>接下来我会追问：如果我们约定，用箭头表示其前后的两次输出之间有 1 秒的时间间隔，而逗号表示其前后的两次输出之间的时间间隔可以忽略，代码实际运行的结果该如何描述？会有下面两种答案：</p>
<ul>
<li>A. 60% 的人会描述为：5 -&gt; 5 -&gt; 5 -&gt; 5 -&gt; 5，即每个 5 之间都有 1 秒的时间间隔；</li>
<li>B. 40% 的人会描述为：5 -&gt; 5,5,5,5,5，即第 1 个 5 直接输出，1 秒之后，输出 5 个 5；<br>这就要求候选人对 JS 中的定时器工作机制非常熟悉，循环执行过程中，几乎同时设置了 5 个定时器，一般情况下，这些定时器都会在 1 秒之后触发，而循环完的输出是立即执行的，显而易见，正确的描述是 B。</li>
</ul>
<p>如果到这里算是及格的话，100 个人参加面试只有 20 人能及格，读到这里的同学可以仔细思考，你及格了么？</p>
<p><strong>追问 1：闭包</strong></p>
<p>如果这道题仅仅是考察候选人对 JS 异步代码、变量作用域的理解，局限性未免太大，接下来我会追问，如果期望代码的输出变成：5 -&gt; 0,1,2,3,4，该怎么改造代码？熟悉闭包的同学很快能给出下面的解决办法：</p>
<p><b>for (var i = 0; i &lt; 5; i++) {<br>    (function(j) {  // j = i<br>        setTimeout(function() {<br>            console.log(new Date, j);<br>        }, 1000);<br>    })(i);<br>}</b></p>
<p>console.log(new Date, i);<br>巧妙的利用 IIFE（Immediately Invoked Function Expression：声明即执行的函数表达式）来解决闭包造成的问题，确实是不错的思路，但是初学者可能并不觉得这样的代码很好懂，至少笔者初入门的时候这里琢磨了一会儿才真正理解。</p>
<p>有没有更符合直觉的做法？答案是有，我们只需要对循环体稍做手脚，让负责输出的那段代码能拿到每次循环的 i 值即可。该怎么做呢？利用 JS 中基本类型（Primitive Type）的参数传递是按值传递（Pass by Value）的特征，不难改造出下面的代码：</p>
<p><b>var output = function (i) {<br>    setTimeout(function() {<br>        console.log(new Date, i);<br>    }, 1000);<br>};</b></p>
<p>for (var i = 0; i &lt; 5; i++) {<br>    output(i);  // 这里传过去的 i 值被复制了<br>}</p>
<p>console.log(new Date, i);<br>能给出上述 2 种解决方案的候选人可以认为对 JS 基础的理解和运用是不错的，可以各加 10 分。当然实际面试中还有候选人给出如下的代码：</p>
<p><b>for (let i = 0; i &lt; 5; i++) {<br>    setTimeout(function() {<br>        console.log(new Date, i);<br>    }, 1000);<br>}</b></p>
<p>console.log(new Date, i);<br>细心的同学会发现，这里只有个非常细微的变动，即使用 ES6 块级作用域（Block Scope）中的 let 替代了 var，但是代码在实际运行时会报错，因为最后那个输出使用的 i 在其所在的作用域中并不存在，i 只存在于循环内部。</p>
<p>能想到 ES6 特性的同学虽然没有答对，但是展示了自己对 ES6 的了解，可以加 5 分，继续进行下面的追问。</p>
<p><strong>追问 2：ES6</strong></p>
<p>有经验的前端同学读到这里可能有些不耐烦了，扯了这么多，都是他知道的内容，先别着急，挑战的难度会继续增加。</p>
<p>接着上文继续追问：如果期望代码的输出变成 0 -&gt; 1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5，并且要求原有的代码块中的循环和两处 console.log 不变，该怎么改造代码？新的需求可以精确的描述为：代码执行时，立即输出 0，之后每隔 1 秒依次输出 1,2,3,4，循环结束后在大概第 5 秒的时候输出 5（这里使用大概，是为了避免钻牛角尖的同学陷进去，因为 JS 中的定时器触发时机有可能是不确定的，具体可参见 How Javascript Timers Work）。</p>
<p>看到这里，部分同学会给出下面的可行解：</p>
<p><b>for (var i = 0; i &lt; 5; i++) {<br>    (function(j) {<br>        setTimeout(function() {<br>            console.log(new Date, j);<br>        }, 1000 * j));  // 这里修改 0~4 的定时器时间<br>    })(i);<br>}</b></p>
<p>setTimeout(function() { // 这里增加定时器，超时设置为 5 秒<br>    console.log(new Date, i);<br>}, 1000 * i);<br>不得不承认，这种做法虽粗暴有效，但是不算是能额外加分的方案。如果把这次的需求抽象为：在系列异步操作完成（每次循环都产生了 1 个异步操作）之后，再做其他的事情，代码该怎么组织？聪明的你是不是想起了什么？对，就是 Promise。</p>
<p>可能有的同学会问，不就是在控制台输出几个数字么？至于这样杀鸡用牛刀？你要知道，面试官真正想考察的是候选人是否具备某种能力和素质，因为在现代的前端开发中，处理异步的代码随处可见，熟悉和掌握异步操作的流程控制是成为合格开发者的基本功。</p>
<p>顺着下来，不难给出基于 Promise 的解决方案（既然 Promise 是 ES6 中的新特性，我们的新代码使用 ES6 编写是不是会更好？如果你这么写了，大概率会让面试官心生好感）：</p>
<p><b>const tasks = [];<br>for (var i = 0; i &lt; 5; i++) {   // 这里 i 的声明不能改成 let，如果要改该怎么做？<br>    ((j) =&gt; {<br>        tasks.push(new Promise((resolve) =&gt; {<br>            setTimeout(() =&gt; {<br>                console.log(new Date, j);<br>                resolve();  // 这里一定要 resolve，否则代码不会按预期 work<br>            }, 1000 * j);   // 定时器的超时时间逐步增加<br>        }));<br>    })(i);<br>}</b></p>
<p>Promise.all(tasks).then(() =&gt; {<br>    setTimeout(() =&gt; {<br>        console.log(new Date, i);<br>    }, 1000);   // 注意这里只需要把超时设置为 1 秒<br>});<br>相比而言，笔者更倾向于下面这样看起来更简洁的代码，要知道编程风格也是很多面试官重点考察的点，代码阅读时的颗粒度更小，模块化更好，无疑会是加分点。</p>
<p><b>const tasks = []; // 这里存放异步操作的 Promise<br>const output = (i) =&gt; new Promise((resolve) =&gt; {<br>    setTimeout(() =&gt; {<br>        console.log(new Date, i);<br>        resolve();<br>    }, 1000 * i);<br>});</b></p>
<p>// 生成全部的异步操作<br>for (var i = 0; i &lt; 5; i++) {<br>    tasks.push(output(i));<br>}</p>
<p>// 异步操作完成之后，输出最后的 i<br>Promise.all(tasks).then(() =&gt; {<br>    setTimeout(() =&gt; {<br>        console.log(new Date, i);<br>    }, 1000);<br>});<br>读到这里的同学，恭喜你，你下次面试遇到类似的问题，至少能拿到 80 分。</p>
<p>我们都知道使用 Promise 处理异步代码比回调机制让代码可读性更高，但是使用 Promise 的问题也很明显，即如果没有处理 Promise 的 reject，会导致错误被丢进黑洞，好在新版的 Chrome 和 Node 7.x 能对未处理的异常给出 Unhandled Rejection Warning，而排查这些错误还需要一些特别的技巧（浏览器、Node.js）。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>感谢你花时间读到这里，相信你收获的不仅仅是用 JS 精确控制代码输出的各种技巧，更是对于前端工程师的成长期许：扎实的语言基础、与时俱进的能力、强大技术自驱力。</p>
<h4 id="One-More-Thing"><a href="#One-More-Thing" class="headerlink" title="One More Thing"></a>One More Thing</h4><p>本文作者王仕军，商业转载请联系作者获得授权，非商业转载请注明出处。如果你觉得本文对你有帮助，请点赞！如果对文中的内容有任何疑问，欢迎留言讨论。想知道我接下来会写些什么？欢迎订阅知乎专栏：《前端周刊：让你在前端领域跟上时代的脚步》。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ning101.cn/2017/04/26/我是一个线程/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="唐宁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/26/我是一个线程/" itemprop="url">我是一个线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-26T10:46:38+08:00">
                2017-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/操作系统/" itemprop="url" rel="index">
                    <span itemprop="name">操作系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第一回-初生牛犊"><a href="#第一回-初生牛犊" class="headerlink" title="第一回 初生牛犊"></a>第一回 初生牛犊</h2><p>我是一个线程，我一出生就被编了个号：0x3704，然后被领到一个昏暗的屋子里，在这里我发现了很多和我一模一样的同伴。<br>我身边的同伴0x6900 待的时间比较长，他带着沧桑的口气对我说：“我们线程的宿命就是处理包裹。把包裹处理完以后还得马上回到这里，否则可能永远回不来了。”<br>我一脸懵懂，“包裹，什么包裹？”<br>“不要着急，马上你就会明白了，我们这里是不养闲人的。”<br>果然，没多久，屋子的门开了， 一个面貌凶恶的家伙吼道：“0x3704 ,出来！”<br>我一出来就被塞了一个沉甸甸的包裹，上面还附带着一个写满了操作步骤的纸。<br>“快去，把这个包裹处理了。”<br>“去哪儿处理？”<br>“跟着指示走，先到就绪车间。”<br>果然，地上有指示箭头，跟着它来到了一间明亮的大屋子，这里已经有不少线程了，大家都很紧张，好像时刻准备着往前冲。<br>我刚一进来，就听见广播说：“0x3704，进入车间。”<br>我赶紧往前走，身后有很多人议论。<br>“他太幸运了，刚进入就绪状态就能运行。”<br>“是不是有关系？”<br>“不是，你看人家的优先级多高啊，唉！”<br>前边就是车间，这里简直是太美了，怪不得老线程总是唠叨着说：“要是能一直待在这里就好了。”<br>这里空间大，视野好，空气清新，鸟语花香，还有很多从来没见过的人，像服务员一样等着为我服务。<br>他们也都有编号，更重要的是每个人还有个标签，上面写着：硬盘、数据库、内存、网卡……<br>我现在理解不了，看看操作步骤吧。</p>
<h4 id="第一步：从包裹中取出参数。"><a href="#第一步：从包裹中取出参数。" class="headerlink" title="第一步：从包裹中取出参数。"></a>第一步：从包裹中取出参数。</h4><p>打开包裹，里边有个HttpRequest对象，可以取到userName、 password两个参数。</p>
<h4 id="第二步：执行登录操作。"><a href="#第二步：执行登录操作。" class="headerlink" title="第二步：执行登录操作。"></a>第二步：执行登录操作。</h4><p>奥，原来是有人要登录啊，我把userName、password交给数据库服务员，他拿着数据，慢腾腾地走了。<br>他怎么这么慢？不过我是不是正好可以在车间里多待一会儿？反正也没法执行第三步。<br>就在这时，车间里的广播响了：“0x3704，我是CPU，记住你正在执行的步骤，然后马上带着包裹离开！”<br>我慢腾腾地开始收拾。<br>“快点，别的线程马上就要进来了。”<br>离开这个车间，又来到一个大屋子，这里有很多线程在慢腾腾地喝茶，打牌。<br>“哥们，你们没事干了？”<br>“你新来的吧，你不知道我在等数据库服务员给我数据啊！据说他们比我们慢好几十万倍，在这里好好歇吧。”<br>“啊？ 这么慢！我这里有人在登录系统，能等这么长时间吗？”<br>“放心，你没听说过人间一天，CPU一年吗？我们这里是用纳秒、毫秒计时的，人间等待一秒，相当于我们好几天呢，来得及。”<br>干脆睡一会吧。不知道过了多久，大喇叭又开始广播了：“0x3704，你的数据来了，快去执行！”<br>我转身就往CPU车间跑，发现这里的门只出不进！<br>后面传来阵阵哄笑声：“果然是新人，不知道还得去就绪车间等。”<br>于是赶紧到就绪车间，这次没有那么好运了，等了好久才被再次叫进CPU车间。<br>在等待的时候，我听见有人小声议论：<br>“听说了吗，最近有个线程被kill掉了。”<br>“为啥啊？”<br>“这家伙赖在CPU车间不走，把CPU利用率一直搞成100%，后来就被kill掉了。”<br>“Kill掉以后弄哪儿去了？”<br>“可能被垃圾回收了吧。”<br>我心里打了个寒噤，赶紧接着处理，剩下的动作快多了，第二步登录成功。</p>
<h4 id="第三步：构建登录成功后的主页。"><a href="#第三步：构建登录成功后的主页。" class="headerlink" title="第三步：构建登录成功后的主页。"></a>第三步：构建登录成功后的主页。</h4><p>这一步有点费时，因为有很多HTML需要处理，不知道代码谁写的，处理起来很烦人。<br>我正在紧张的制作HTML呢， CPU又开始叫了：<br>“0x3704，我是CPU ，记住你正在执行的步骤，然后马上带着包裹离开！”<br>“为啥啊？”<br>“每个线程只能在CPU上运行一段时间，到了时间就得让别人用了，你去就绪车间待着，等着叫你吧。”<br>就这样，我一直在“就绪——运行”这两个状态中不知道轮转了多少次， 终于按照步骤清单把工作做完了。<br>最后顺利地把包含html的包裹发了回去。至于登录以后干什么事儿，我就不管了。马上就要回到我那昏暗的房间了，真有点舍不得这里。不过相对于有些线程，我还是幸运的，他们运行完以后就被彻底地销毁了，而我还活着！<br>回到了小黑屋，老线程0x6900问：<br>“怎么样？第一天有什么感觉？”<br>“我们的世界规则很复杂，首先你不知道什么时候会被挑中执行；第二，在执行的过程中随时可能被打断，让出CPU车间；第三，一旦出现硬盘、数据库这样耗时的操作，也得让出CPU去等待；第四，就是数据来了，你也不一定马上执行，还得等着CPU挑选。”<br>“小伙子理解的不错啊。”<br>“我不明白为什么很多线程执行完任务就死了，为什么咱们还活着？”<br>“你还不知道？长生不老是我们的特权！我们这里有个正式的名称，叫作<strong>线程池！</strong>”</p>
<h2 id="第二回-渐入佳境"><a href="#第二回-渐入佳境" class="headerlink" title="第二回 渐入佳境"></a>第二回 渐入佳境</h2><p>平淡的日子就这么一天天地过去，作为一个线程，我每天的生活都是取包裹、处理包裹，然后回到我们昏暗的家：线程池。<br>有一天我回来的时候，听到有个兄弟说，今天要好好休息下，明天就是最疯狂的一天。我看了一眼日历，明天是 11月11号。<br>果然，零点刚过，不知道那些人类怎么了，疯狂地投递包裹，为了应付蜂拥而至的海量包裹，线程池里没有一个人能闲下来，全部出去处理包裹，CPU车间利用率超高，硬盘在嗡嗡转，网卡疯狂的闪，即便如此，还是处理不完，堆积如山。<br>我们也没有办法，实在是太多太多了，这些包裹中大部分都是浏览页面，下订单，买、买、买。<br>不知道过了多久，包裹山终于慢慢地消失了。终于能够喘口气，我想我永远都不会忘记这一天。<br>通过这个事件，我明白了我所处的世界：这是一个电子商务的网站！<br>我每天的工作就是处理用户的登录，浏览，购物车，下单，付款。<br>我问线程池的元老0x6900：“我们要工作到什么时候？”<br>“要一直等到系统重启的那一刻。”0x6900说。<br>“那你经历过系统重启吗？”<br>“怎么可能？系统重启就是我们的死亡时刻，也就是世界末日，一旦重启，整个线程池全部销毁，时间和空间全部消失，一切从头再来。”<br>“那什么时候会重启？”<br>“这就不好说了，好好享受眼前的生活吧……”<br>其实生活还是丰富多彩的，我最喜欢的包裹是上传图片，由于网络慢，所以能在就绪车间、CPU车间待很长很长时间，可以认识很多好玩的线程。<br>比如说上次认识了memecached 线程，他对我说在他的帮助下缓存了很多的用户数据，还是分布式的！很多机器上都有！<br>我问他：“怪不得后来的登录操作快了那么多，原来是不再从数据库取数据了你那里就有啊，哎对了你是分布式的你去过别的机器没有？”<br>他说：“怎么可能！我每次也只能通过网络往那个机器发送一个GET、PUT命令才存取数据而已，别的一概不知。”<br>再比如说上次在等待的时候遇到了数据库连接的线程，我才知道他那里也是一个连接池，和我们的线程池几乎一模一样。<br>他告诉我：“有些包裹太变态了，竟然查看一年的订单数据，简直把我累死了。”<br>我说：“拉倒吧你，你那是纯数据，你把数据传给我以后，我还得组装成HTML，工作量不知道比你大多少倍。”<br>他建议我：“你一定要和memecached搞好关系，直接从他那儿拿数据，尽量少直接调用数据库，这样我们JDBC connection也能活得轻松点。”<br>我欣然接纳：“好啊好啊，关键是你得提前把数据搞到缓存啊，要不然我先问一遍缓存，没有数据，我这不还得找你吗？”<br>生活就是这样，如果你自己不找点乐子，还有什么意思？</p>
<h2 id="第三回-虎口脱险"><a href="#第三回-虎口脱险" class="headerlink" title="第三回 虎口脱险"></a>第三回 虎口脱险</h2><p>前几天我遇到一个可怕的事情，差一点死在外边，回不了线程池了。其实这次遇险我应该能够预想得到才对，真是太大意了。<br>那天我处理了一些从http发来的存款和取款的包裹，老线程0x6900特意嘱咐我：“处理这些包裹的时候一定要特别小心，你必须先获得一把锁，在对账户存款或取款的时候一定要把账户锁住，要不然别的线程就会在你等待的时候趁虚而入，搞破坏，我年轻那会儿很毛糙，就捅了篓子。”<br>为了“恐吓”我， 好心的0x6900还给了我两个表格：<br>(1)没有加锁的情况<br><img src="/imgs/1.jpg" alt="没有加锁"></p>
<p>(2)加锁的情况<br> <img src="/imgs/2.jpg" alt="加锁"></p>
<p>我看得胆颤心惊，原来不加锁会带来这么严重的事故。从此以后看到存款、取款的包裹就倍加小心，还好没有出过事故。<br>今天我收到的一个包裹是转账，从某著名演员的账户给某著名导演的账户转钱，具体是谁我就不透漏了，数额可真是不小。<br>我按照老线程的吩咐，肯定要加锁啊，先对著名演员的账户加锁，再对著名导演的账户加锁。<br>可我万万没想到的是，还有一个线程，对，就是0x7954, 竟然同时在从这个导演的账户往这个演员的账户转账。<br>于是乎，就出现了这么个情况：<br><img src="/imgs/3.jpg" alt="丢失"></p>
<p>刚开始我还不知道什么情况，一直坐在等待车间傻等，可是等的时间太长了，长达几十秒！我可从来没有经历过这样的事件。<br>这时候我就看到了线程0x7954 , 他悠闲地坐在那里喝咖啡，我和他聊了起来：<br>“哥们，我看你已经喝了8杯咖啡了，怎么还不去干活？”<br>“你不喝了9杯茶了吗？”0x7954回敬道。<br>“我在等一个锁，不知道哪个孙子一直不释放！”<br>“我也在等锁啊，我要是知道哪个孙子不释放锁我非揍死他不可！”0x7954毫不示弱。<br>我偷偷地看了一眼，这家伙怀里不就抱着我正等的某导演的锁吗？<br>很明显，0x7954也发现了我正抱着他正在等待的锁。<br>很快我们两个就吵了起来，互不相让：<br>    “把你的锁先给我，让我先做完！”<br>“不行，从来都是做完工作才释放锁，现在绝对不能给你！”<br>从争吵到打起来，就那么几秒钟的事儿。更重要的是，我们俩不仅仅持有这个著名导演和演员的锁，还有很多其他的锁，导致等待的线程越来越多，围观的人们把屋子都挤满了。最后事情真的闹大了，我从来没见过的终极大boss“操作系统”也来了。大Boss毕竟见多识广，他看了一眼，哼了一声，很不屑地说：<br>“又出现死锁了。”<br>“你们俩要Kill掉一个，来吧，过来抽签。”<br>这一下子把我给吓尿了，这么严重啊！我战战兢兢地抽了签，打开一看，是个“活”字。唉，小命终于保住了。<br>可怜的0x7954被迫交出了所有的资源以后，很不幸地被kill掉，消失了。我拿到了导演的锁，可以开始干活了。大Boss“操作系统”如一阵风似的消失了，身后只传来他的声音：<br>“记住，我们这里导演&gt;演员，无论任何情况都要先获得导演的锁。”<br>由于这里不仅仅只有导演和演员，还有很多其他人，大Boss留下了一个表格， 里边是个算法，用来计算资源的大小，计算出来以后，永远按照从大到小的方式来获得锁：<br><img src="/imgs/4.jpg" alt=""></p>
<p>我回到线程池，大家都知道了我的历险，围着我问个不停。<br>凶神恶煞的线程调度员把大Boss的算法贴到了墙上。<br>每天早上，我们都得像无节操的房屋中介、美容美发店的服务员一样，站在门口，像被耍猴一样大声背诵：<br><strong>“多个资源加锁要牢记，一定要按Boss的算法比大小，然后从最大的开始加锁。”</strong></p>
<h2 id="第四回-江湖再见"><a href="#第四回-江湖再见" class="headerlink" title="第四回 江湖再见"></a>第四回 江湖再见</h2><p>又过了很多天，我和其他线程们发现了一个奇怪的事情：包裹的处理越来越简单，不管任何包裹，不管是登录、浏览、存钱……处理的步骤都是一样的, 返回一个固定的html页面。<br>有一次我偷偷地看了一眼，上面写着：“本系统将于今晚 00:00 至4:00 进行维护升级， 给您带来的不便我们深感抱歉！”<br>我去告诉了老线程0x6904,他叹了一口气说：<br>“唉，我们的生命也到头了，看来马上就要重启系统，我们就要消失了，再见吧兄弟。”<br>系统重启的那一刻终于到来了。我看到屋子里的东西一个个的不见了，等待车间、就绪车间，甚至CPU车间都慢慢地消失了。我身边的线程兄弟也越来越少，最后只剩我自己了。<br>我在空旷的原野上大喊：“还有人吗？”<br>无人应答。<br>我们这一代线程池完成了使命……<br>不过下一代线程池即将重生！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="唐宁">
          <p class="site-author-name" itemprop="name">唐宁</p>
           
              <p class="site-description motion-element" itemprop="description">16计师唐宁的个人博客</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ning101" target="_blank" rel="external nofollow">GitHub</a>
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/5336625860" target="_blank" rel="external nofollow">新浪微博</a>
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  新浪微博
                
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.cqnu.edu.cn/" title="重庆师范大学" target="_blank">重庆师范大学</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://ning.dev.dxdc.net/grwzjs/" title="我的网站" target="_blank">我的网站</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">唐宁</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

</body>
</html>
